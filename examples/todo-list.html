<!DOCTYPE html>
<html style='--background-image-url: url("https://picsum.photos/id/972/800.jpg");'>
  <head>
    <title>SmarkForm TODO-List Example</title>
    <meta name='viewport' content='width=device-width, initial-scale=1.0'>
    <meta http-equiv='Content-Type' content='text/html; charset=utf-8'>
    <link rel='stylesheet' href='https://cdn.jsdelivr.net/gh/bitifet/SmarkForm@0.1.4/examples/smarkform_layout_sample.css'>
    <link rel='stylesheet' href='https://cdn.jsdelivr.net/gh/bitifet/SmarkForm@0.1.4/examples/smarkform_styles_sample.css'>
    <script>
      const bgImg = `https://picsum.photos/id/${1+Math.floor(Math.random()*1084)}/800.jpg`;
      document.documentElement.style.setProperty('--background-image-url', `url("${bgImg}")`);
      document.addEventListener("DOMContentLoaded", function() {
          const backgroundAnchor = document.getElementById("background-anchor");
          if (backgroundAnchor) {
              backgroundAnchor.textContent = bgImg;
              backgroundAnchor.href = bgImg;
              backgroundAnchor.parentNode.classList.remove("hidden");
              console.log(backgroundAnchor, bgImg);
          }
      
      });
    </script>
    <script defer src='https://cdn.jsdelivr.net/gh/bitifet/SmarkForm@0.1.4/dist/SmarkForm.umd.js'></script>
    <script>
      document.addEventListener('DOMContentLoaded', function() {
      
          // Form instantiation:
          // -------------------
          window.form = new SmarkForm(
              document.querySelector("#main-form")
              , {
                  autoId: true,
                  onAfterAction_export({data}) {
                      alert (JSON.stringify(data, null, 4));
                  },
                  async onBeforeAction_empty({context, preventDefault}) {
                      if (
                          ! await context.isEmpty()
                          && ! confirm("Are you sure?")
                      ) preventDefault();
                  },
                  onBeforeAction_import(options) {
                      let data = prompt('Provide JSON data');
                      try {
                          options.data = JSON.parse(data);
                      } catch (err) {
                          if (data.length) {
                              alert ('‚ö†Ô∏è  Invalid JSON!!');
                              data = null;
                          } else {
                              data = {}; // Drop form contents
                          };
                      };
                      if (data === null) options.preventDefault();
                  },
              }
          );
      
          // List items addition/removal animation:
          // --------------------------------------
          form
              .onAll("addItem", function({
                  newItemTarget,
                  onRendered,
              }) {
                  newItemTarget.classList.add("ingoing");
                  onRendered(()=>{
                      newItemTarget.classList.remove("ingoing")
                      newItemTarget.classList.add("ongoing");
                  });
              })
              .onAll("removeItem", async function({
                  oldItemTarget,
                  onRemmoved,
              }) {
                  oldItemTarget.classList.remove("ongoing");
                  oldItemTarget.classList.add("outgoing");
      
                  // Await for transition to be finished before item removal:
                  const [duration, multiplier = 1000] = window.getComputedStyle(oldItemTarget)
                      .getPropertyValue('transition-duration')
                      .slice(0,-1).replace("m","/1")
                      .split("/")
                      .map(Number)
                  ;
                  await new Promise(resolve=>setTimeout(
                      resolve
                      , duration * multiplier
                  ));
              })
          ;
      
      });
    </script>
  </head>
  <body>
    <div class='main-container'>
      <div class='smarkForm' id='main-form'>
        <header>
          <h1>SmarkForm TODO-List Example</h1><small>
            <p>
              This example demonstrates how to create a simple form
              layout that can almost responsively expand and stack
              depending on the width of the page.
            </p>
            <p><span>Background image courtesy of </span><a href='https://picsum.photos/' target='_blank'>https://picsum.photos/</a></p>
            <p class='hidden'><b>Url:</b><a id='background-anchor' href=''></a></p></small>
        </header>
        <section>
          <div class='form-group h1 nowrap'>
            <div class='spacer'></div>
            <button data-smark='{"action":"import","for":"tasklist"}'>üìÇ Import (JSON)</button>
            <button data-smark='{"action":"export","for":"tasklist"}'>üíæ Export (JSON)</button>
          </div>
          <div class='form-group' data-smark='{"type":"list","name":"tasklist","exportEmpties":true,"min_items":0}'>
            <fieldset class='form-group aside reverse' data-smark='{"exportEmpties":false}'>
              <button class='inline' data-smark='{"action":"removeItem"}' title='Remove task'>‚ùå</button>
              <div class='form-group spacer'>
                <div class='form-group'>
                  <input data-smark name='title' type='text' placeholder='Task title'>
                </div>
                <div class='form-group'>
                  <div class='input-group'>
                    <label>Goals</label>
                    <div data-smark='{"name":"goals","type":"list","of":"singleton","max_items":100}'>
                      <div class='singleton'>
                        <button data-smark='{"action":"addItem"}' title='Add new item below'>‚ûï</button>
                        <input data-smark='data-smark' type='text' placeholder='New goal...'/>
                        <button data-smark='{"action":"removeItem","failback":"clear"}' title='Remove this item'>‚ûñ</button>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </fieldset>
          </div>
          <div class='form-group f1 nowrap' style='text-align: right'>
            <div class='spacer'></div>
            <button data-smark='{"action":"empty","for":"tasklist","autoscroll":"elegant"}' title='Clear form data'>‚ùå Clear all</button>
            <button data-smark='{"action":"removeItem","for":"tasklist","to":"*","autoscroll":"elegant","keep_non_empty":true}' title='Clear all empty tasks'>üßπ Clear empty</button>
            <button data-smark='{"action":"addItem","for":"tasklist"}'>‚ûï Add new task</button>
          </div>
        </section>
      </div>
    </div>
  </body>
</html>