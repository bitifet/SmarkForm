!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):(t="undefined"!=typeof globalThis?globalThis:t||self).SmarkForm=e()}(this,(function(){"use strict";function t(o,i,s,a){return(t=function(){function t(t,e){return function(n){!function(t,e){if(t.v)throw new Error("attempted to call addInitializer after decoration was finished")}(e),s(n,"An initializer"),t.push(n)}}function o(t,e){if(!t(e))throw new TypeError("Attempted to access private element on non-instance")}function i(e,n,i,s,a,c,l,d,u){var p;switch(a){case 1:p="accessor";break;case 2:p="method";break;case 3:p="getter";break;case 4:p="setter";break;default:p="field"}var h,f,g={kind:p,name:l?"#"+n:r(n),static:c,private:l},m={v:!1};if(0!==a&&(g.addInitializer=t(s,m)),l||0!==a&&2!==a)if(2===a)h=function(t){return o(u,t),i.value};else{var y=0===a||1===a;(y||3===a)&&(h=l?function(t){return o(u,t),i.get.call(t)}:function(t){return i.get.call(t)}),(y||4===a)&&(f=l?function(t,e){o(u,t),i.set.call(t,e)}:function(t,e){i.set.call(t,e)})}else h=function(t){return t[n]},0===a&&(f=function(t,e){t[n]=e});var _=l?u.bind():function(t){return n in t};g.access=h&&f?{get:h,set:f,has:_}:h?{get:h,has:_}:{set:f,has:_};try{return e(d,g)}finally{m.v=!0}}function s(t,e){if("function"!=typeof t)throw new TypeError(e+" must be a function")}function a(t,e){var n=typeof e;if(1===t){if("object"!==n||null===e)throw new TypeError("accessor decorators must return an object with get, set, or init properties or void 0");void 0!==e.get&&s(e.get,"accessor.get"),void 0!==e.set&&s(e.set,"accessor.set"),void 0!==e.init&&s(e.init,"accessor.init")}else if("function"!==n)throw new TypeError((0===t?"field":10===t?"class":"method")+" decorators must return a function or void 0")}function c(t){return function(e){t(this,e)}}function l(t,e,r,o,s,l,d,u,p){var h,f,g,m,y,_,v,b,E=r[0];if(d?(0===s||1===s?(h={get:(y=r[3],function(){return y(this)}),set:c(r[4])},g="get"):3===s?(h={get:r[3]},g="get"):4===s?(h={set:r[3]},g="set"):h={value:r[3]},0!==s&&(1===s&&n(h.set,"#"+o,"set"),n(h[g||"value"],"#"+o,g))):0!==s&&(h=Object.getOwnPropertyDescriptor(e,o)),1===s?m={get:h.get,set:h.set}:2===s?m=h.value:3===s?m=h.get:4===s&&(m=h.set),"function"==typeof E)void 0!==(_=i(E,o,h,u,s,l,d,m,p))&&(a(s,_),0===s?f=_:1===s?(f=_.init,v=_.get||m.get,b=_.set||m.set,m={get:v,set:b}):m=_);else for(var w=E.length-1;w>=0;w--){var T;void 0!==(_=i(E[w],o,h,u,s,l,d,m,p))&&(a(s,_),0===s?T=_:1===s?(T=_.init,v=_.get||m.get,b=_.set||m.set,m={get:v,set:b}):m=_,void 0!==T&&(void 0===f?f=T:"function"==typeof f?f=[f,T]:f.push(T)))}if(0===s||1===s){if(void 0===f)f=function(t,e){return e};else if("function"!=typeof f){var S=f;f=function(t,e){for(var n=e,r=0;r<S.length;r++)n=S[r].call(t,n);return n}}else{var I=f;f=function(t,e){return I.call(t,e)}}t.push(f)}0!==s&&(1===s?(h.get=m.get,h.set=m.set):2===s?h.value=m:3===s?h.get=m:4===s&&(h.set=m),d?1===s?(t.push((function(t,e){return m.get.call(t,e)})),t.push((function(t,e){return m.set.call(t,e)}))):2===s?t.push(m):t.push((function(t,e){return m.call(t,e)})):Object.defineProperty(e,o,h))}function d(t,n,r){for(var o,i,s,a=[],c=new Map,d=new Map,p=0;p<n.length;p++){var h=n[p];if(Array.isArray(h)){var f,g,m=h[1],y=h[2],_=h.length>3,v=m>=5,b=r;if(v?(f=t,0!=(m-=5)&&(g=i=i||[]),_&&!s&&(s=function(n){return e(n)===t}),b=s):(f=t.prototype,0!==m&&(g=o=o||[])),0!==m&&!_){var E=v?d:c,w=E.get(y)||0;if(!0===w||3===w&&4!==m||4===w&&3!==m)throw new Error("Attempted to decorate a public method/accessor that has the same name as a previously decorated public method/accessor. This is not currently supported by the decorators plugin. Property name was: "+y);!w&&m>2?E.set(y,m):E.set(y,!0)}l(a,f,h,y,m,v,_,g,b)}}return u(a,o),u(a,i),a}function u(t,e){e&&t.push((function(t){for(var n=0;n<e.length;n++)e[n].call(t);return t}))}return function(e,n,r,o){return{e:d(e,n,o),get c(){return function(e,n){if(n.length>0){for(var r=[],o=e,i=e.name,s=n.length-1;s>=0;s--){var c={v:!1};try{var l=n[s](o,{kind:"class",name:i,addInitializer:t(r,c)})}finally{c.v=!0}void 0!==l&&(a(10,l),o=l)}return[o,function(){for(var t=0;t<r.length;t++)r[t].call(o)}]}}(e,r)}}}}())(o,i,s,a)}function e(t){if(Object(t)!==t)throw TypeError("right-hand side of 'in' should be an object, got "+(null!==t?typeof t:"null"));return t}function n(t,e,n){"symbol"==typeof e&&(e=(e=e.description)?"["+e+"]":"");try{Object.defineProperty(t,"name",{configurable:!0,value:n?n+" "+e:e})}catch(t){}return t}function r(t){var e=function(t,e){if("object"!=typeof t||!t)return t;var n=t[Symbol.toPrimitive];if(void 0!==n){var r=n.call(t,e||"default");if("object"!=typeof r)return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(t,"string");return"symbol"==typeof e?e:String(e)}const o=Symbol("Events"),i=Symbol("allEvents"),s=/^on(?:Before|After)Action_/,a=/^onLocal_/,c=/^onAll_/;function l(t,e,n){return t.has(e)||t.set(e,[]),t.get(e).push(n.bind(this)),this}var d,u,p={disEnhance(t){t.target.tagName.toLowerCase()&&t.target.addEventListener("submit",(function(t){t.preventDefault()}))}};const h={},f=Symbol("smart_component"),g=/^[a-z0-9_]+$/i,m=/[\*\?]/,y=class extends Error{constructor(t,e,n){super("RenderError(".concat(n,"): ").concat(e)),this.code=t,this.path=n,this.stack=this.stack.split("\n").slice(2).join("\n")}};let _,v;function b(t,e){if(void 0!==h[t])throw new Error("Duplicate component type definition: ".concat(t));if(!(e.prototype instanceof _))throw new Error("Bad component type implementation for: ".concat(t));h[t]=e}u=class{constructor(t){let{property_name:e="smark",...n}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=arguments.length>2?arguments[2]:void 0;const o=this;if(o.validName=function(){let t=0;return function(){for(var e=arguments.length,n=new Array(e),r=0;r<e;r++)n[r]=arguments[r];for(let t of n)if("string"==typeof t&&(t=t.trim(),t.length))return t;return"UNNAMED"+ ++t}}(),o.actions={},o.property_name=e,o.selector="[data-".concat(o.property_name,"]"),o.types=h,o.target=t,o.options=n,o.setNodeOptions(o.target,o.options),o.parent=r,!o.parent instanceof _)throw o.renderError("INVALID_PARENT","Smark Components must have valid Smark Component parent.");o.root=null===o.parent?o:o.parent.root,o.parents={},o.parents[Symbol.iterator]=function*(){let t=o;for(;t;)yield t,t=t.parent};const i=o.inherittedOption("autoId",!1);let s;o.genId=!1!==i&&(!0===i?t=>t.replace(/\//g,"_"):"string"==typeof i?t=>i+t.replace(/\//g,"_"):"function"==typeof i&&i),o.onRenderedTasks=[],o.rendered=new Promise((t=>s=t)),o.children={},o.target[f]=o,(async()=>{await o.render();for(const t of o.onRenderedTasks)await t();o.onRenderedTasks=null,s(!0)})(),o.options.onRendered&&o.onRendered(o.options.onRendered)}onRendered(t){const e=this;e.onRenderedTasks?e.onRenderedTasks.push(t.bind(e)):t.bind(e)()}getNodeOptions(t,e){const n=(t.dataset[this.property_name]||"").trim()||null,r={...e,...(()=>{try{const t=JSON.parse(n);if("object"!=typeof t)throw new Error("NO_OBJECT");return t}catch(t){return n.match(g)?{type:n}:{}}})()};return r.action||r.type||(r.type=function(t,e){switch(t.tagName.toLowerCase()){case"ul":case"ol":case"table":case"thead":case"tbody":case"tfoot":return"list";case"input":const e=String(t.getAttribute("type")||"").toLowerCase();switch(e){case"number":case"date":return e}case"textarea":case"select":return"input";default:return"form"}}(t)),this.setNodeOptions(t,r),r}setNodeOptions(t,e){t.dataset[this.property_name]=JSON.stringify(e)}async enhance(t,e){const n=this;let r=n.getNodeOptions(t,e);if(p.disEnhance(n),r.action){if(r.type||(r.type="trigger"),"trigger"!=r.type)throw n.renderError("ACTION_IN_NON_TRIGGER",'"action" property is only allowed for "trigger" components but "'.concat(r.type,'" type specified.'));delete r.name}else if("string"!=typeof r.type)throw n.renderError("NO_TYPE_PROVIDED","Invalid SmarkForm item: type is mandatory for non trigger components.");const o=n.types[r.type];if(!o)throw n.renderError("UNKNOWN_TYPE","Unimplemented SmarkForm component controller: ".concat(r.type));return new o(t,r,n)}getComponent(t){var e;return t[f]||(null===(e=t.parentElement)||void 0===e?void 0:e.closest(this.selector)[f])||null}getPath(){return[...this.parents].map((t=>t.name)).reverse().join("/")||"/"}find(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",e=this;if("/"==t[0])for(;e.parent;)e=e.parent;const n=t.split("/").filter((t=>t)),r=n.findIndex((t=>t.match(m)));if(r>=0){const t=(o=n[r],new RegExp("^"+o.replace(/\*+/g,".*").replace(/\?/g,".")+"$")),i=n.slice(0,r).join("/"),s=n.slice(r+1).join("/"),a=e.find(i);return Object.entries(a.children).filter((e=>{let[n,r]=e;return r&&n.match(t)})).map((t=>{let[,e]=t;return e.find(s)})).flat(1/0)}var o;return n.reduce(((t,e)=>void 0===t?null:".."==e?t.parent:t.children[e]),e)}inherittedOption(t,e){const n=this;for(const e of n.parents)if(void 0!==e.options[t])return e.options[t];return e}moveTo(){const t=this;t.target.id||(t.target.id=t.getPath()),document.location.hash=t.target.id,window.history.pushState({},void 0,window.location.pathname)}getTriggers(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;const e=this,n=[];for(const r of[...e.root.target.querySelectorAll(e.selector)].map((t=>t[f])).filter((t=>t))){const o=r.getTriggerArgs();o&&(Object.is(o.context,e)&&(!t||1+[t].flat().findIndex((t=>t==o.action)))&&n.push(r))}return n}updateId(){const t=this;if(!1===t.genId)return;const e=t.genId(t.getPath());if(t.target.id!=e){t.target.id=e;for(const e of Object.values(t.children))e.updateId()}return t.target.id}getTriggerArgs(){}renderError(t,e){return new y(t,e,this.getPath())}},[_,d]=t(u,[],[function(t,e){let{kind:n}=e;if("class"==n)return class extends t{constructor(t,e){const n={},r=[];for(const[t,o]of Object.entries(e))t.match(s)?r.push([t.substring(2),o,"onLocal"]):t.match(a)?r.push([t.substring(8),o,"onLocal"]):t.match(c)?r.push([t.substring(6),o,"onAll"]):n[t]=o;for(var d=arguments.length,u=new Array(d>2?d-2:0),p=2;p<d;p++)u[p-2]=arguments[p];super(t,n,...u);const h=this,f=Object.is(h,h.root);h[o]=new Map,f&&(h.root[i]=new Map),h.onLocal=l.bind(h,h[o]),h.onAll=l.bind(h.root,h.root[i]),h.on=h.onLocal;for(const[t,e,n]of r)h[n](t,e)}async emit(t,e){const n=[...this[o].get(t)||[],...this.root[i].get(t)||[]];let r=!1;if(n.length){let t=!1;e.preventDefault=()=>r=!0,e.stopPropagation=()=>t=!0;for(const r of n){if(t)break;await r(e)}}return!r}}}]).c,d(),function(t){let e=function(){function t(){this._dropEffect="move",this._effectAllowed="all",this._data={}}return Object.defineProperty(t.prototype,"dropEffect",{get:function(){return this._dropEffect},set:function(t){this._dropEffect=t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"effectAllowed",{get:function(){return this._effectAllowed},set:function(t){this._effectAllowed=t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"types",{get:function(){return Object.keys(this._data)},enumerable:!0,configurable:!0}),t.prototype.clearData=function(t){null!==t?delete this._data[t.toLowerCase()]:this._data={}},t.prototype.getData=function(t){let e=t.toLowerCase(),n=this._data[e];return"text"===e&&null==n&&(n=this._data["text/plain"]),n||""},t.prototype.setData=function(t,e){this._data[t.toLowerCase()]=e},t.prototype.setDragImage=function(t,e,r){let o=n._instance;o._imgCustom=t,o._imgOffset={x:e,y:r}},t}();t.DataTransfer=e;let n=function(){function t(){if(this._lastClick=0,t._instance)throw"DragDropTouch instance already created.";let e=!1;if(document.addEventListener("test",(function(){}),{get passive(){return e=!0,!0}}),navigator.maxTouchPoints){let t=document,n=this._touchstart.bind(this),r=this._touchmove.bind(this),o=this._touchend.bind(this),i=!!e&&{passive:!1,capture:!1};t.addEventListener("touchstart",n,i),t.addEventListener("touchmove",r,i),t.addEventListener("touchend",o),t.addEventListener("touchcancel",o)}}return t.getInstance=function(){return t._instance},t.prototype._touchstart=function(e){let n=this;if(this._shouldHandle(e)){this._reset();let r=this._closestDraggable(e.target);r&&(this._dispatchEvent(e,"mousemove",e.target)||this._dispatchEvent(e,"mousedown",e.target)||(this._dragSource=r,this._ptDown=this._getPoint(e),this._lastTouch=e,setTimeout((function(){n._dragSource===r&&null===n._img&&n._dispatchEvent(e,"contextmenu",r)&&n._reset()}),t._CTXMENU),t._ISPRESSHOLDMODE&&(this._pressHoldInterval=setTimeout((function(){n._isDragEnabled=!0,n._touchmove(e)}),t._PRESSHOLDAWAIT))))}},t.prototype._touchmove=function(t){if(this._shouldCancelPressHoldMove(t))this._reset();else if(this._shouldHandleMove(t)||this._shouldHandlePressHoldMove(t)){let e=this._getTarget(t);if(this._dispatchEvent(t,"mousemove",e))return this._lastTouch=t,void t.preventDefault();if(this._dragSource&&!this._img&&this._shouldStartDragging(t)){if(this._dispatchEvent(this._lastTouch,"dragstart",this._dragSource))return void(this._dragSource=null);this._createImage(t),this._dispatchEvent(t,"dragenter",e)}this._img&&(this._lastTouch=t,t.preventDefault(),this._dispatchEvent(t,"drag",this._dragSource),e!==this._lastTarget&&(this._dispatchEvent(this._lastTouch,"dragleave",this._lastTarget),this._dispatchEvent(t,"dragenter",e),this._lastTarget=e),this._moveImage(t),this._isDropZone=this._dispatchEvent(t,"dragover",e))}},t.prototype._touchend=function(t){if(this._shouldHandle(t)){if(this._dispatchEvent(this._lastTouch,"mouseup",t.target))return void t.preventDefault();this._img||(this._dragSource=null,this._dispatchEvent(this._lastTouch,"click",t.target),this._lastClick=Date.now()),this._destroyImage(),this._dragSource&&(t.type.indexOf("cancel")<0&&this._isDropZone&&this._dispatchEvent(this._lastTouch,"drop",this._lastTarget),this._dispatchEvent(this._lastTouch,"dragend",this._dragSource),this._reset())}},t.prototype._shouldHandle=function(t){return t&&!t.defaultPrevented&&t.touches&&t.touches.length<2},t.prototype._shouldHandleMove=function(e){return!t._ISPRESSHOLDMODE&&this._shouldHandle(e)},t.prototype._shouldHandlePressHoldMove=function(e){return t._ISPRESSHOLDMODE&&this._isDragEnabled&&e&&e.touches&&e.touches.length},t.prototype._shouldCancelPressHoldMove=function(e){return t._ISPRESSHOLDMODE&&!this._isDragEnabled&&this._getDelta(e)>t._PRESSHOLDMARGIN},t.prototype._shouldStartDragging=function(e){let n=this._getDelta(e);return n>t._THRESHOLD||t._ISPRESSHOLDMODE&&n>=t._PRESSHOLDTHRESHOLD},t.prototype._reset=function(){this._destroyImage(),this._dragSource=null,this._lastTouch=null,this._lastTarget=null,this._ptDown=null,this._isDragEnabled=!1,this._isDropZone=!1,this._dataTransfer=new e,clearInterval(this._pressHoldInterval)},t.prototype._getPoint=function(t,e){return t&&t.touches&&(t=t.touches[0]),{x:e?t.pageX:t.clientX,y:e?t.pageY:t.clientY}},t.prototype._getDelta=function(e){if(t._ISPRESSHOLDMODE&&!this._ptDown)return 0;let n=this._getPoint(e);return Math.abs(n.x-this._ptDown.x)+Math.abs(n.y-this._ptDown.y)},t.prototype._getTarget=function(t){let e=this._getPoint(t),n=document.elementFromPoint(e.x,e.y);for(;n&&"none"==getComputedStyle(n).pointerEvents;)n=n.parentElement;return n},t.prototype._createImage=function(e){this._img&&this._destroyImage();let n=this._imgCustom||this._dragSource;if(this._img=n.cloneNode(!0),this._copyStyle(n,this._img),this._img.style.top=this._img.style.left="-9999px",!this._imgCustom){let r=n.getBoundingClientRect(),o=this._getPoint(e);this._imgOffset={x:o.x-r.left,y:o.y-r.top},this._img.style.opacity=t._OPACITY.toString()}this._moveImage(e),document.body.appendChild(this._img)},t.prototype._destroyImage=function(){this._img&&this._img.parentElement&&this._img.parentElement.removeChild(this._img),this._img=null,this._imgCustom=null},t.prototype._moveImage=function(t){let e=this;requestAnimationFrame((function(){if(e._img){let n=e._getPoint(t,!0),r=e._img.style;r.position="absolute",r.pointerEvents="none",r.zIndex="999999",r.left=Math.round(n.x-e._imgOffset.x)+"px",r.top=Math.round(n.y-e._imgOffset.y)+"px"}}))},t.prototype._copyProps=function(t,e,n){for(let r=0;r<n.length;r++){let o=n[r];t[o]=e[o]}},t.prototype._copyStyle=function(e,n){if(t._rmvAtts.forEach((function(t){n.removeAttribute(t)})),e instanceof HTMLCanvasElement){let t=e,r=n;r.width=t.width,r.height=t.height,r.getContext("2d").drawImage(t,0,0)}let r=getComputedStyle(e);for(let t=0;t<r.length;t++){let e=r[t];e.indexOf("transition")<0&&(n.style[e]=r[e])}n.style.pointerEvents="none";for(let t=0;t<e.children.length;t++)this._copyStyle(e.children[t],n.children[t])},t.prototype._setOffsetAndLayerProps=function(t,e){let n;void 0===t.offsetX&&(n=e.getBoundingClientRect(),t.offsetX=t.clientX-n.x,t.offsetY=t.clientY-n.y),void 0===t.layerX&&(n=n||e.getBoundingClientRect(),t.layerX=t.pageX-n.left,t.layerY=t.pageY-n.top)},t.prototype._dispatchEvent=function(e,n,r){if(e&&r){let o=new Event(n,{bubbles:!0,cancelable:!0}),i=e.touches?e.touches[0]:e;return o.button=0,o.which=o.buttons=1,this._copyProps(o,e,t._kbdProps),this._copyProps(o,i,t._ptProps),this._setOffsetAndLayerProps(o,r),o.dataTransfer=this._dataTransfer,r.dispatchEvent(o),o.defaultPrevented}return!1},t.prototype._closestDraggable=function(t){for(;t;t=t.parentElement)if(t.draggable)return t;return null},t}();n._instance=new n,n._THRESHOLD=5,n._OPACITY=.5,n._DBLCLICK=500,n._CTXMENU=900,n._ISPRESSHOLDMODE=!1,n._PRESSHOLDAWAIT=400,n._PRESSHOLDMARGIN=25,n._PRESSHOLDTHRESHOLD=0,n._rmvAtts="id,class,style,draggable".split(","),n._kbdProps="altKey,ctrlKey,metaKey,shiftKey".split(","),n._ptProps="pageX,pageY,clientX,clientY,screenX,screenY,offsetX,offsetY".split(","),t.DragDropTouch=n}(v||(v={}));const E=Symbol("beforeEventName"),w=Symbol("afterEventName"),T=function(t,e){let{kind:n,name:r,addInitializer:o}=e;"method"==n&&o((function(){this.actions[r]=t.bind(this),this.actions[r][E]="BeforeAction_".concat(r),this.actions[r][w]="AfterAction_".concat(r)}))};class S extends _{render(){const t=this;t.parent.onRendered((()=>{var e;const n=t.getTriggerArgs();"function"==typeof(null===(e=n.context)||void 0===e?void 0:e.onTriggerRender)&&n.context.onTriggerRender(n)}))}disable(){this.target.disabled=!0}enable(){this.target.disabled=!1}getTriggerArgs(){const t=this,e=[...t.parents],{action:n,for:r,to:o}=t.options;if(!n)return;let[i,s]=n.split(":").reverse();const a=r?t.parent.find(r):e.find((t=>(!s||t.options.type==s)&&"function"==typeof t.actions[i])),c=o?a.find(o):r?null:e.find((t=>{var e;return null===(e=t.parent)||void 0===e?void 0:e.target.isSameNode(null==a?void 0:a.target)}));return{action:i,origin:t,context:a,target:c,...t.options}}}async function I(t){const e=this,n=e.getComponent(t.target).getTriggerArgs();if(!n)return;const{context:r,action:o}=n,i=null==r?void 0:r.actions[o];if("function"!=typeof i)throw e.renderError("UNKNOWN_ACTION","Unknown action ".concat(o)+(r?" for ".concat(r.options.type):""));if(await e.emit(i[E],n)){const t=await i(n);e.emit(i[w],{...n,data:t})}}function O(t,e){let n=t.parentNode;const r=e>=0?1:-1;for(;n;){if(n.scrollHeight>n.clientHeight*r){var o=n.scrollHeight-n.clientHeight*r;if(e<=o*r)return void(n.scrollTop+=e);n.scrollTop=o,e-=o}n=n.parentNode}}const x=function(e,n){let{kind:r}=n;var o,i;if("class"==r)return i=class extends e{constructor(){super(...arguments),o(this)}render(){const t=super.render(...arguments),e=this;return e.root.onRendered((()=>{e.fold({operation:e.options.folded?"fold":"unfold"})})),t}fold(){let{operation:t="toggle"}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};const e=this,n="none"==e.target.style.display,r="fold"==t||"unfold"!=t&&!n;e.target.style.display=r?"none":e.originalDisplayProp,e.getTriggers("fold").forEach((t=>{const{foldedClass:e,unfoldedClass:n}=t.options;e&&t.target.classList[r?"add":"remove"](e),n&&t.target.classList[r?"remove":"add"](n)})),e.getTriggers(["addItem","removeItem"]).map(r?t=>t.disable():t=>t.enable())}},[o]=t(i,[[T,2,"fold"]],[]).e,i};var N,D,P;let A;P=class extends _{constructor(){super(...arguments),D(this)}async render(){const t=this;t.originalDisplayProp=t.target.style.display;for(const e of function(t,e){const n=null===t.parentNode?t=>null===t:e=>null===e||e.isSameNode(t);return[...t.querySelectorAll(e)].filter((t=>n(t.parentNode.closest(e))))}(t.target,t.selector)){const n=await t.enhance(e);"trigger"!=n.options.type&&(n.name=t.validName(n.options.name,e.getAttribute("name")),t.children[n.name]=n,n.updateId())}}async export(){return Object.fromEntries(await Promise.all(Object.entries(this.children).map((async t=>{let[e,n]=t;return[e,await n.export()]}))))}async import(t){let{data:e={}}=t;const n=Object(e).constructor;if(n!=={}.constructor)throw this.renderError("FORM_NOT_PLAIN_OBJECT","Expected plain object for form import, ".concat(n.name," given."));return Object.fromEntries(await Promise.all(Object.entries(this.children).map((async t=>{let[n,r]=t;return[n,await r.import({data:e[n]})]}))))}async isEmpty(){const t=this;for(const e of Object.values(t.children))if(!await e.isEmpty())return!1;return!0}async empty(){return await this.import({data:{}})}},({e:[D],c:[A,N]}=t(P,[[T,2,"export"],[T,2,"import"],[T,2,"empty"]],[x])),N();const L=Symbol("smart_mutex");class C{constructor(){this.mtx=Promise.resolve()}lock(){let t;const e=new Promise((e=>{t=()=>e()})),n=this.mtx;return this.mtx=e,n.then((function(){return t}))}}const R=function(t){return function(e,n){let{kind:r}=n;if("method"==r)return async function(){const n=this;n[L]||(n[L]={}),n[L][t]||(n[L][t]=new C);const r=await n[L][t].lock();let o,i;try{for(var s=arguments.length,a=new Array(s),c=0;c<s;c++)a[c]=arguments[c];i=await e.call(n,...a)}catch(t){o=t}if(r(),o)throw o;return i}}};var k,H,M,j,F,X;let Y;H=R("list_mutating"),M=R("list_mutating"),j=R("list_mutating");var U,B,z,G,K,W;X=class extends _{constructor(){super(...arguments),F(this)}render(){const t=this;t.originalDisplayProp=t.target.style.display,t.min_items=Math.max(0,"number"==typeof t.options.min_items?t.options.min_items:1),t.max_items=Math.max(t.min_items,"number"==typeof t.options.max_items?t.options.max_items:1/0),t.children=[];const e=t.target.children.length;if(1!=e)throw t.renderError("LIST_WRONG_NUM_CHILDREN","List components must contain exactly 1 direct children, but ".concat(e," given"));if(t.itemTpl=t.target.children[0],null!==t.itemTpl.querySelector("[id]"))throw t.renderError("LIST_CONTAINS_ID","List components are not allowed to contain elements with 'id' attribute");const n=t.getNodeOptions(t.itemTpl,{type:t.options.of});if(t.options.of&&n.type!=t.options.of)throw t.renderError("LIST_ITEM_TYPE_MISSMATCH","List item type missmatch");t.root.onRendered((async()=>{for(let e=0;e<t.min_items;e++)await t.addItem();0==t.min_items&&t.getTriggers("count").forEach((e=>e.target.innerText=String(t.children.length)))})),t.itemTpl.remove()}async move(t,e){const n=this;if(null===e||null===t)return;const r=Number(null==t?void 0:t.name),o=Number(null==e?void 0:e.name);if(r==o)return;if(r<o){const t=[...n.children.slice(r+1,o+1),n.children[r]].map(((t,e)=>(t.name=e+r,t.updateId(),t)));n.children.splice(r,o-r+1,...t)}else if(r>o){const t=[n.children[r],...n.children.slice(o,r)].map(((t,e)=>(t.name=e+o,t.updateId(),t)));n.children.splice(o,r-o+1,...t)}const i=(r<o?1:-1)>0?"after":"before";e.target[i](t.target)}onTriggerRender(t){let{action:e,origin:n}=t;switch(e){case"addItem":case"removeItem":null===(r=n.target).getAttribute("tabindex")&&r.setAttribute("tabindex","-1")}var r}async export(){const t=this,e=[],n=!t.inherittedOption("exportEmpties",!1);for(const r of t.children)n&&await r.isEmpty()||e.push(await r.export());return e}async import(t){let{data:e=[]}=t;const n=this;!e instanceof Array&&(e=[e]);for(let t=0;t<Math.min(e.length,n.max_items);t++)n.children.length<=t&&await n.addItem(),await n.children[t].import({data:e[t]});for(let t=Math.max(e.length,n.min_items);t<n.children.length;)await n.removeItem();e.length>n.max_items&&n.emit("error",{code:"LIST_IMPORT_OVERFLOW",message:"Trying to import array greater than list's max_items. Data beyond max_items ignored.",context:n,data:e,options:n.options});for(let t=e.length;t<n.children.length;t++)n.children[t].empty()}async addItem(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};const e=this;let{action:n,origin:r=null,context:o=e,target:i,position:s="after",autoscroll:a}=t;if("after"!=s&&"before"!=s)throw e.renderError("LIST_WRONG_ADDITEM_POSITION","Invalid value for addItem() position property: ".concat(s));if(e.children.length>=e.max_items)return void e.emit("error",{code:"LIST_MAX_ITEMS_REACHED",message:"Cannot add items over max_items boundary",options:t});e.children.length&&!i&&(i="before"==s?e.children[0]:e.children[e.children.length-1]);const c=e.itemTpl.cloneNode(!0),l=[];let d;if(await e.emit("addItem",{action:n,origin:r,context:o,target:i,position:s,newItemTarget:c,options:t,onRendered:t=>l.push(t)}),e.children.length?e.children=(await Promise.all(e.children.map((async(t,n)=>t.target.isSameNode(i.target)?"after"==s?(t.target.after(c),d=await e.enhance(c,{type:"form"}),await d.rendered,[t,d]):(t.target.before(c),d=await e.enhance(c,{type:"form"}),await d.rendered,[d,t]):t)))).flat().map(((t,e)=>(t.name=e,t.updateId(),t))):(e.target.appendChild(c),d=await e.enhance(c,{type:"form",name:0}),await d.rendered,e.children.push(d),d.name=0,d.updateId()),"elegant"==a&&d)O(d.target,-d.offsetHeight);else{const t=d?"self"==a?d:"parent"==a?d.parent:null:null;t&&t.moveTo()}l.forEach((t=>t(d))),e.getTriggers("count").forEach((t=>t.target.innerText=String(e.children.length)))}async removeItem(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};const e=this;let{action:n,origin:r=null,context:o=e,target:i,autoscroll:s,keep_non_empty:a,failback:c}=t;if(!i){if(a)for(const t of[...e.children].reverse())if(await t.isEmpty()){i=t;break}i||(i=e.children[e.children.length-1],a=!1)}const l=i instanceof Array?i:[i];for(const i of[...l].reverse()){if(e.children.length<=e.min_items)switch(c){case"none":break;case"clear":return void await i.empty();default:return void e.emit("error",{code:"LIST_MIN_ITEMS_REACHED",message:"Cannot remove items under min_items boundary",options:t})}if(a&&!await i.isEmpty())continue;let l=null;const d=e.children.filter((t=>{if(t.target.isSameNode(i.target)){if("elegant"==s)O(t.target,t.target.offsetHeight);else{const e="self"==s?t:"parent"==s?t.parent:null;e&&e.moveTo()}return l=t,!1}return!0})).map(((t,e)=>(t.name=e,t.updateId(),t))),u=[];await e.emit("removeItem",{action:n,origin:r,context:o,target:i,oldItem:l,oldItemTarget:l.target,options:t,onRemoved:t=>u.push(t)}),l.target.remove(),e.children=d,e.getTriggers("count").forEach((t=>t.target.innerText=String(e.children.length))),u.forEach((t=>t()))}}async isEmpty(){const t=this;for(const e of t.children)if(!await e.isEmpty())return!1;return!0}async empty(){return await this.import({data:[]})}count(){return this.children.length}},({e:[F],c:[Y,k]}=t(X,[[[H,T],2,"export"],[T,2,"import"],[[T,M],2,"addItem"],[[T,j],2,"removeItem"],[T,2,"empty"],[T,2,"count"]],[x,function(t,e){let{kind:n}=e;if("class"==n)return class extends t{render(){const t=super.render(...arguments),e=this;if(e.sortable=!!e.options.sortable,e.itemTpl.setAttribute("draggable",e.sortable),e.children.forEach((t=>t.target.setAttribute("dragable",e.sortable))),e.sortable){let t=null,n=null;e.target.addEventListener("dragstart",(e=>{null===t?t=e.target:e.preventDefault()})),e.target.addEventListener("dragover",(t=>t.preventDefault())),e.target.addEventListener("drop",(e=>{let r=e.target;for(;r.parentElement&&r.parentElement!=t.parentElement;)r=r.parentElement;n=r})),e.target.addEventListener("dragend",(async()=>{n&&await e.move(e.getComponent(t),e.getComponent(n)),t=null,n=null}))}return t}}}])),k();class q extends A{constructor(){super(...arguments),U(this)}async render(){const t=this;if(t.isSingleton=!("INPUT"===t.target.tagName||"SELECT"===t.target.tagName||"TEXTAREA"===t.target.tagName),t.isCheckbox=!t.isSingleton&&"checkbox"==String(t.target.type).toLowerCase(),t.isSingleton){await super.render();const e=Object.keys(t.children).length;if(1!=e)throw t.renderError("NOT_A_SINGLETON","Singleton forms are only allowed to contain exactly one"+" data field but ".concat(e," found."))}t.targetField=t.isSingleton?t.children[0]:t.target}async export(){const t=this;return t.isSingleton?Object.values(await super.export())[0]:t.isCheckbox?!!t.target.checked:t.target.value}async import(t){let{data:e=""}=t;const n=this;return n.isSingleton?await super.import({data:Object.fromEntries([[Object.keys(n.children)[0],e]])}):(n.isCheckbox?n.target.checked=!!e:n.target.value=e,n.target.value)}async isEmpty(){return!(this.isCheckbox?"":await this.export()).trim().length}async empty(){await this.import({data:""})}}B=q,[U]=t(B,[[T,2,"export"],[T,2,"import"],[T,2,"empty"]],[]).e;class J extends q{constructor(){super(...arguments),z(this)}async render(){await super.render();const t=this,e=t.targetField.tagName,n=t.targetField.getAttribute("type");if("INPUT"!=e||"number"!=(n||"number").toLowerCase())throw t.renderError("NOT_A_NUMBER_FIELD",'Number inputs require an INPUT tag of type "number".');n||(t.targetField.type="number")}async export(){const t=await super.export();return t.length&&!isNaN(t)?Number(t):null}async import(t){let{data:e=null}=t;const n=typeof e;return await super.import({data:"number"==n?e:"string"==n&&e.length&&!isNaN(e)?Number(e):null})}async isEmpty(){return null===await this.export()}}G=J,[z]=t(G,[[T,2,"export"],[T,2,"import"]],[]).e;const V=/T.*/;function Z(t){return 8==t.length?new Date([t.substring(0,4),t.substring(4,6),t.substring(6,8)].join("-")):10==t.length&&"-"==t[4]&&"-"==t[7]?new Date(t):NaN}function $(t){return t.toISOString().replace(V,"")}class Q extends q{constructor(){super(...arguments),K(this)}async render(){await super.render();const t=this,e=t.targetField.tagName,n=t.targetField.getAttribute("type");if("INPUT"!=e||"date"!=(n||"date").toLowerCase())throw t.renderError("NOT_A_DATE_FIELD",'Date inputs require an INPUT tag of type "date".');n||(t.targetField.type="date")}async export(){const t=await super.export();if(!t.length)return null;const e=Z(t);return isNaN(e)?null:$(e)}async import(t){let{data:e=null}=t;const n=e instanceof Date?e:"number"==typeof e?new Date(e):e&&"string"==typeof e?Z(e):NaN;return await super.import({data:isNaN(n)?null:$(n)})}async isEmpty(){return null===await this.export()}}W=Q,[K]=t(W,[[T,2,"export"],[T,2,"import"]],[]).e;for(const[t,e]of Object.entries({trigger:S,form:A,list:Y,input:q,number:J,date:Q}))b(t,e);class tt extends A{constructor(t){let{customActions:e={},...n}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const r={...n,name:"",type:"form"};super(t,r,null);const o=this;o.setNodeOptions(o.target,r),o.actions={...o.actions,...Object.fromEntries(Object.entries(e).map((t=>{let[e,n]=t;return[e,n.bind(o)]})))},o.target.addEventListener("click",I.bind(o),!0)}}return tt.createType=b,tt}));