!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):(t="undefined"!=typeof globalThis?globalThis:t||self).SmarkForm=e()}(this,function(){"use strict";function t(t,e,n){if("function"==typeof t?t===e:t.has(e))return arguments.length<3?e:n;throw new TypeError("Private element is not present on this object")}function e(t){if(Object(t)!==t)throw TypeError("right-hand side of 'in' should be an object, got "+(null!==t?typeof t:"null"));return t}function n(t,e){(function(t,e){if(e.has(t))throw new TypeError("Cannot initialize the same private elements twice on an object")})(t,e),e.add(t)}function r(t,e,n){return(e=l(e))in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function o(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter(function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable})),n.push.apply(n,r)}return n}function i(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?o(Object(n),!0).forEach(function(e){r(t,e,n[e])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):o(Object(n)).forEach(function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))})}return t}function a(t,e){if(null==t)return{};var n,r,o=function(t,e){if(null==t)return{};var n={};for(var r in t)if({}.hasOwnProperty.call(t,r)){if(-1!==e.indexOf(r))continue;n[r]=t[r]}return n}(t,e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);for(r=0;r<i.length;r++)n=i[r],-1===e.indexOf(n)&&{}.propertyIsEnumerable.call(t,n)&&(o[n]=t[n])}return o}function s(t,e,n){"symbol"==typeof e&&(e=(e=e.description)?"["+e+"]":"");try{Object.defineProperty(t,"name",{configurable:!0,value:n?n+" "+e:e})}catch(t){}return t}function l(t){var e=function(t,e){if("object"!=typeof t||!t)return t;var n=t[Symbol.toPrimitive];if(void 0!==n){var r=n.call(t,e);if("object"!=typeof r)return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(t,"string");return"symbol"==typeof e?e:e+""}function c(t,n,r,o){return(c=function(){function t(t,e){return function(n){!function(t){if(t.v)throw Error("attempted to call addInitializer after decoration was finished")}(e),o(n,"An initializer"),t.push(n)}}function n(t,e){if(!t(e))throw new TypeError("Attempted to access private element on non-instance")}function r(e,r,o,i,a,s,c,d,u){var p;switch(a){case 1:p="accessor";break;case 2:p="method";break;case 3:p="getter";break;case 4:p="setter";break;default:p="field"}var g,f,h={kind:p,name:c?"#"+r:l(r),static:s,private:c},m={v:!1};if(0!==a&&(h.addInitializer=t(i,m)),c||0!==a&&2!==a)if(2===a)g=function(t){return n(u,t),o.value};else{var y=0===a||1===a;(y||3===a)&&(g=c?function(t){return n(u,t),o.get.call(t)}:function(t){return o.get.call(t)}),(y||4===a)&&(f=c?function(t,e){n(u,t),o.set.call(t,e)}:function(t,e){o.set.call(t,e)})}else g=function(t){return t[r]},0===a&&(f=function(t,e){t[r]=e});var v=c?u.bind():function(t){return r in t};h.access=g&&f?{get:g,set:f,has:v}:g?{get:g,has:v}:{set:f,has:v};try{return e(d,h)}finally{m.v=!0}}function o(t,e){if("function"!=typeof t)throw new TypeError(e+" must be a function")}function i(t,e){var n=typeof e;if(1===t){if("object"!==n||null===e)throw new TypeError("accessor decorators must return an object with get, set, or init properties or void 0");void 0!==e.get&&o(e.get,"accessor.get"),void 0!==e.set&&o(e.set,"accessor.set"),void 0!==e.init&&o(e.init,"accessor.init")}else if("function"!==n)throw new TypeError((0===t?"field":10===t?"class":"method")+" decorators must return a function or void 0")}function a(t){return function(e){t(this,e)}}function c(t,e,n,o,l,c,d,u,p){var g,f,h,m,y,v,N,b,w=n[0];if(d?(0===l||1===l?(g={get:(y=n[3],function(){return y(this)}),set:a(n[4])},h="get"):3===l?(g={get:n[3]},h="get"):4===l?(g={set:n[3]},h="set"):g={value:n[3]},0!==l&&(1===l&&s(g.set,"#"+o,"set"),s(g[h||"value"],"#"+o,h))):0!==l&&(g=Object.getOwnPropertyDescriptor(e,o)),1===l?m={get:g.get,set:g.set}:2===l?m=g.value:3===l?m=g.get:4===l&&(m=g.set),"function"==typeof w)void 0!==(v=r(w,o,g,u,l,c,d,m,p))&&(i(l,v),0===l?f=v:1===l?(f=v.init,N=v.get||m.get,b=v.set||m.set,m={get:N,set:b}):m=v);else for(var E=w.length-1;E>=0;E--){var _;void 0!==(v=r(w[E],o,g,u,l,c,d,m,p))&&(i(l,v),0===l?_=v:1===l?(_=v.init,N=v.get||m.get,b=v.set||m.set,m={get:N,set:b}):m=v,void 0!==_&&(void 0===f?f=_:"function"==typeof f?f=[f,_]:f.push(_)))}if(0===l||1===l){if(void 0===f)f=function(t,e){return e};else if("function"!=typeof f){var T=f;f=function(t,e){for(var n=e,r=0;r<T.length;r++)n=T[r].call(t,n);return n}}else{var x=f;f=function(t,e){return x.call(t,e)}}t.push(f)}0!==l&&(1===l?(g.get=m.get,g.set=m.set):2===l?g.value=m:3===l?g.get=m:4===l&&(g.set=m),d?1===l?(t.push(function(t,e){return m.get.call(t,e)}),t.push(function(t,e){return m.set.call(t,e)})):2===l?t.push(m):t.push(function(t,e){return m.call(t,e)}):Object.defineProperty(e,o,g))}function d(t,n,r){for(var o,i,a,s=[],l=new Map,d=new Map,p=0;p<n.length;p++){var g=n[p];if(Array.isArray(g)){var f,h,m=g[1],y=g[2],v=g.length>3,N=m>=5,b=r;if(N?(f=t,0!=(m-=5)&&(h=i=i||[]),v&&!a&&(a=function(n){return e(n)===t}),b=a):(f=t.prototype,0!==m&&(h=o=o||[])),0!==m&&!v){var w=N?d:l,E=w.get(y)||0;if(!0===E||3===E&&4!==m||4===E&&3!==m)throw Error("Attempted to decorate a public method/accessor that has the same name as a previously decorated public method/accessor. This is not currently supported by the decorators plugin. Property name was: "+y);!E&&m>2?w.set(y,m):w.set(y,!0)}c(s,f,g,y,m,N,v,h,b)}}return u(s,o),u(s,i),s}function u(t,e){e&&t.push(function(t){for(var n=0;n<e.length;n++)e[n].call(t);return t})}return function(e,n,r,o){return{e:d(e,n,o),get c(){return function(e,n){if(n.length>0){for(var r=[],o=e,a=e.name,s=n.length-1;s>=0;s--){var l={v:!1};try{var c=n[s](o,{kind:"class",name:a,addInitializer:t(r,l)})}finally{l.v=!0}void 0!==c&&(i(10,c),o=c)}return[o,function(){for(var t=0;t<r.length;t++)r[t].call(o)}]}}(e,r)}}}}())(t,n,r,o)}function d(t,e){const n=null===t.parentNode?t=>null===t:e=>null===e||e.isSameNode(t);return[...t.querySelectorAll(e)].filter(t=>n(t.parentNode.closest(e)))}function u(t,e){let n=t.parentNode;const r=e>=0?1:-1;for(;n;){if(n.scrollHeight>n.clientHeight*r){var o=n.scrollHeight-n.clientHeight*r;if(e<=o*r)return void(n.scrollTop+=e);n.scrollTop=o,e-=o}n=n.parentNode}}function p(){return Math.random().toString(36).substring(2)}function g(t){try{return JSON.parse(t)}catch(t){}}function f(t){if(5===t.length&&":"===t[2]){const e=parseInt(t.substring(0,2),10),n=parseInt(t.substring(3,5),10);if(e>=0&&e<=23&&n>=0&&n<=59)return t+":00"}if(8===t.length&&":"===t[2]&&":"===t[5]){const e=parseInt(t.substring(0,2),10),n=parseInt(t.substring(3,5),10),r=parseInt(t.substring(6,8),10);if(e>=0&&e<=23&&n>=0&&n<=59&&r>=0&&r<=59)return t}if(6===t.length){const e=parseInt(t.substring(0,2),10),n=parseInt(t.substring(2,4),10),r=parseInt(t.substring(4,6),10);if(e>=0&&e<=23&&n>=0&&n<=59&&r>=0&&r<=59)return[t.substring(0,2),t.substring(2,4),t.substring(4,6)].join(":")}if(4===t.length){const e=parseInt(t.substring(0,2),10),n=parseInt(t.substring(2,4),10);if(e>=0&&e<=23&&n>=0&&n<=59)return[t.substring(0,2),t.substring(2,4),"00"].join(":")}return null}function h(t){if(15===t.length&&"T"===t[8]){const e=[t.substring(0,4),t.substring(4,6),t.substring(6,8)].join("-"),n=[t.substring(9,11),t.substring(11,13),t.substring(13,15)].join(":");return new Date("".concat(e,"T").concat(n))}if(13===t.length&&"T"===t[8]){const e=[t.substring(0,4),t.substring(4,6),t.substring(6,8)].join("-"),n=[t.substring(9,11),t.substring(11,13),"00"].join(":");return new Date("".concat(e,"T").concat(n))}if(19===t.length&&"-"===t[4]&&"-"===t[7]&&"T"===t[10]&&":"===t[13]&&":"===t[16])return new Date(t);if(16===t.length&&"-"===t[4]&&"-"===t[7]&&"T"===t[10]&&":"===t[13])return new Date(t+":00");return t.match(/^(\d{4})-(\d{2})-(\d{2})T(\d{2}):(\d{2}):(\d{2})(?:\.\d+)?(?:Z|[+-]\d{2}:\d{2})?$/)?new Date(t):NaN}function m(t,e,n,r){const o=t.tagName,i=t.getAttribute("type");if("INPUT"!=o||(i||e).toLowerCase()!=e){const t=new Error(r);throw t.code=n,t}i||(t.type=e)}const y=Symbol("Events"),v=Symbol("allEvents"),N=/^on(?:Before|After)Action_/,b=/^onLocal_/,w=/^onAll_/,E=["keydown","keyup","keypress","beforeinput","input","change","focus","blur","click","dblclick","contextmenu","mousedown","mouseup","mousemove","mouseenter","mouseleave","mouseover","mouseout","focusin","focusout"];function _(t,e,n){return t.has(e)||t.set(e,[]),t.get(e).push(n.bind(this)),this}var T={disEnhance(t){t.targetNode.tagName.toLowerCase()&&t.targetNode.addEventListener("submit",function(t){t.preventDefault()})}};const x=["property_name"];var A;let k;const I={},S=Symbol("smart_component"),O=/^[a-z0-9_]+$/i,L=/[\*\?]/,P=class extends Error{constructor(t,e,n){super("RenderError(".concat(n,"): ").concat(e)),this.code=t,this.path=n,this.stack=this.stack.split("\n").slice(2).join("\n")}};let j;function D(t,e){if(void 0!==I[t])throw new Error("Duplicate component type definition: ".concat(t));if(!(e.prototype instanceof j))throw new Error("Bad component type implementation for: ".concat(t));I[t]=e}A=class{constructor(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},{property_name:n="smark"}=e,r=a(e,x),o=arguments.length>2?arguments[2]:void 0;const i=this;if(i.validName=function(){let t=0;return function(){if(i.parent.isSingleton)return"";for(var e=arguments.length,n=new Array(e),r=0;r<e;r++)n[r]=arguments[r];for(let t of n)if("string"==typeof t&&(t=t.trim(),t.length))return t;return"UNNAMED"+ ++t}}(),i.actions={},i.property_name=n,i.selector="[data-".concat(i.property_name,"]"),i.types=I,i.targetNode=t,i.options=r,i.setNodeOptions(i.targetNode,i.options),i.parent=o,!i.parent instanceof j)throw i.renderError("INVALID_PARENT","Smark Components must have valid Smark Component parent.");i.root=null===i.parent?i:i.parent.root,i.parents={},i.parents[Symbol.iterator]=function*(){let t=i.parent;for(;t;)yield t,t=t.parent};const s=i.inheritedOption("autoId",!1);let l;i.genId=!1!==s&&(!0===s?t=>t.replace(/\//g,"_"):"string"==typeof s?t=>s+t.replace(/\//g,"_"):"function"==typeof s&&s),i.onRenderedTasks=[],i.renderedSync=!1,i.rendered=new Promise(t=>l=t),i.children={},i.targetNode[S]=i,(async()=>{await i.render();for(const t of i.onRenderedTasks)await t();i.onRenderedTasks=null,l(!0),setTimeout(()=>i.renderedSync=!0,1),await i.emit("afterRender",{context:i},!1)})(),i.options.onRendered&&i.onRendered(i.options.onRendered)}async unrender(){const t=this;await t.emit("beforeUnrender",{context:t},!1),t.targetNode.remove()}onRendered(t){const e=this;e.onRenderedTasks?e.onRenderedTasks.push(t.bind(e)):t.bind(e)()}getNodeOptions(t,e){const n=this;let r=(t.dataset[n.property_name]||"").trim()||null;r==="data-"+n.property_name&&(r=null);let o=g(r);if(!o&&null!==r){if(!O.test(r))throw n.renderError("INVALID_OPTIONS_OBJECT","data-".concat(n.property_name,": must be a valid JSON object."));o={type:r}}const a=i(i({},e),o);if(n.isSingleton&&"label"!==a.type&&!a.hasOwnProperty("action"))for(const t of Object.keys(n.options))if("name"!==t&&("type"!==t||"label"!==a[t])){if(a.hasOwnProperty(t))throw n.renderError("SINGLETON_OPTION_CONFLICT","Singleton field option defined both in parent and schild for key: ".concat(t,"."));"type"!==t&&(a[t]=n.options[t])}return a.action||a.type||(a.type=function(t,e){switch(t.tagName.toLowerCase()){case"ul":case"ol":case"table":case"thead":case"tbody":case"tfoot":return"list";case"input":const n=String(t.getAttribute("type")||"").toLowerCase();if(e.isSingleton)return e.options.type;switch(n){case"number":case"date":case"time":case"datetime-local":case"radio":case"color":return n}case"textarea":case"select":return"input";case"label":return"label";default:return"form"}}(t,n)),n.setNodeOptions(t,a),a}setNodeOptions(t,e){t.dataset[this.property_name]=JSON.stringify(e)}async enhance(t,e){const n=this;let r=n.getNodeOptions(t,e);if(T.disEnhance(n),r.action){if(r.type||(r.type="trigger"),"trigger"!=r.type)throw n.renderError("ACTION_IN_NON_TRIGGER",'"action" property is only allowed for "trigger" components but "'.concat(r.type,'" type specified.'))}else if("string"!=typeof r.type)throw n.renderError("NO_TYPE_PROVIDED","Invalid SmarkForm item: type is mandatory for non trigger components.");const o=n.types[r.type];if(!o)throw n.renderError("UNKNOWN_TYPE","Unimplemented SmarkForm component controller: ".concat(r.type));return new o(t,r,n)}getComponent(t){var e;return t[S]||(null===(e=t.parentElement)||void 0===e?void 0:e.closest(this.selector)[S])||null}getPath(){const t=this,e=[...t.parents].map(t=>t.name).reverse();return t.name&&e.push(t.name),e.join("/")||"/"}find(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";let e=this;for(;!e.name&&null!==e.parent;)e=e.parent;if(t=String(t),"/"==t[0])for(;e.parent;)e=e.parent;const n=t.split("/").filter(t=>t),r=n.findIndex(t=>L.test(t));if(r>=0){const t=(o=n[r],new RegExp("^"+o.replace(/\*+/g,".*").replace(/\?/g,".")+"$")),i=n.slice(0,r).join("/"),a=n.slice(r+1).join("/"),s=e.find(i);return Object.entries(s.children).filter(e=>{let[n,r]=e;return r&&t.test(n)}).map(t=>{let[,e]=t;return e.find(a)}).flat(1/0)}var o;return n.reduce((t,e)=>{if(void 0!==t){if(".."==e)return t.parent;if("."!=e[0])return t.children[e];{if("."==e)return t;if(!t.parent)return;const n=parseInt(e.slice(1));if(isNaN(n))return;if("list"!=t.parent.options.type){const e=Object.keys(t.parent.children),r=e.findIndex(e=>e==t.name),o=e[r+n];return t.parent.children[o]}{const e=parseInt(t.name)+n;if(!isNaN(e))return t.parent.children[e]}}}},e)}inheritedOption(t,e){const n=this;for(const e of[n,...n.parents])if(void 0!==e.options[t])return e.options[t];return e}moveTo(){const t=this;t.targetNode.id||(t.targetNode.id=t.getPath()),document.location.hash=t.targetNode.id,window.history.pushState({},void 0,window.location.pathname)}getTriggers(){const t=this,e=[],n=new Set([arguments.length>0&&void 0!==arguments[0]?arguments[0]:""].flat().map(String).filter(t=>t)),r=n.has("*");for(const o of[t,...t.root.targetNode.querySelectorAll(t.selector)].map(t=>t[S]).filter(t=>t)){const i=o.getTriggerArgs();i&&((Object.is(i.context,t)||Object.is(o,t))&&(r||n.has(i.action))&&e.push(o))}return e}updateId(){const t=this;if(!1===t.genId)return;const e=t.genId(t.getPath());if(t.targetNode.id!=e){t.targetNode.id=e;for(const e of Object.values(t.children))e.updateId()}return t.targetNode.id}focus(){const t=this;for(const e in t.children)return t.children[e].focus();t.targetFieldNode?t.targetFieldNode.focus():t.targetNode.focus()}getTriggerArgs(){}renderError(t,e){var n;const r=this,o=null!==(n=r.parent)&&void 0!==n&&n.isSingleton?r.parent.targetNode:r.targetNode,i=new P(t,e,r.getPath());return function(t,e){const n=document.createElement("div");n.setAttribute("title",e.message),n.setAttribute("style","display: inline-block; padding: .5em 1em; background: red; color: yellow; border-radius: 50% 0%"),n.appendChild(document.createTextNode(e.code));const r=document.createElement("span");r.setAttribute("title","Log the error again"),r.setAttribute("style","cursor: pointer; font-weight: bold; background-color: white; color: red; border-radius: 50%; padding: 0 4px; margin-left: 8px;"),r.textContent="â†§",r.addEventListener("click",()=>{console.error(e)}),n.appendChild(r),t.replaceWith(n)}(o,i),i}},[j,k]=c(A,[],[function(t,e){let{kind:n}=e;if("class"==n)return class extends t{constructor(t,e){const n={},r=[];for(const[t,o]of Object.entries(e))N.test(t)?r.push([t.substring(2),o,"onLocal"]):b.test(t)||(b.test(t)?r.push([t.substring(8),o,"onLocal"]):w.test(t)?r.push([t.substring(6),o,"onAll"]):n[t]=o);for(var o=arguments.length,i=new Array(o>2?o-2:0),a=2;a<o;a++)i[a-2]=arguments[a];super(t,n,...i);const s=this;if(s[y]=new Map,s[v]=new Map,s.onLocal=_.bind(s,s[y]),s.onAll=_.bind(s,s[v]),s.on=s.onAll,s.eventHooks=function(t){const e={};for(const n in t)e[n]=[...t[n]];return Object.defineProperty(e,"_dynamic",{get(){return new Proxy(this,{get:(t,e)=>(e in t||(t[e]=[]),t[e])})}}),e._dynamic}(super.eventHooks),Object.is(s,s.root))for(const t of E)s.targetNode.addEventListener(t,e=>{const n=s.getComponent(e.target),r={type:t,originalEvent:e,context:n,preventDefault:e.preventDefault.bind(e),stopPropagation:e.stopPropagation.bind(e),stopImmediatePropagation:e.stopImmediatePropagation.bind(e)};n.emit(t,r)},!0);for(const[t,e,n]of r)s[n](t,e)}async emit(t,e){let n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];const r=this;let o=!1,a=!1;const s=i(i({},e),{},{type:t,defaultPrevented:!1});n&&(s.preventDefault=()=>s.defaultPrevented=!0,s.stopPropagation=()=>o=!0,s.stopImmediatePropagation=()=>a=!0);const l=[...r[y].get(t)||[],...r[v].get(t)||[]];for(const t of l){if(a)break;await t(e)}for(const n of r.parents){if(o)break;const r=n[v].get(t)||[];for(const t of r){if(a)break;await t(e)}}for(const n of r.eventHooks[t])await n(e);return!s.defaultPrevented}}}]).c,k();class C{constructor(t){const e=this;e.form=t,e.revealed=null;const n=C.onStatusChange.bind(e);e.form.targetNode.addEventListener("keydown",n,!0),e.form.targetNode.addEventListener("keyup",n,!0),e.form.targetNode.addEventListener("focusout",n,!0),e.form.targetNode.addEventListener("focusin",n,!0)}static onStatusChange(t){const e=this;if("keyup"==t.type){if("Control"==t.key)return void e.reveal(!1);if("Alt"!=t.key)return}if("focusout"==t.type)return void(null!==e.revealed&&e.reveal());if("focusin"==t.type&&null===e.revealed)return;const n=t.ctrlKey||"Control"==t.key,r=t.altKey&&"keyup"!=t.type||"Alt"==t.key&&"keydown"==t.type;if(n&&("Control"==t.key||"Alt"==t.key)||"focusin"==t.type){const n=r?2:1;return void e.reveal(t.target,n)}if(e.revealed instanceof Array){const n=e.revealed.find(e=>e.options.hotkey==t.key);n&&(t.preventDefault(),t.stopPropagation(),n.targetNode.disabled||n.targetNode.click())}}reveal(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;const n=this;if(null!==n.revealed){for(const t of n.revealed)t.targetNode.removeAttribute("data-hotkey");n.revealed.length=0}if(!1===t&&(n.revealed=null),t){const r=n.form.getComponent(t),o=function(t){const e=[t,...t.parents];return[...e,...e.map(F).flat()]}(r),i=o.map((t,e)=>{const n=[];for(const r of t.getTriggers("*")){const t=String(r.options.hotkey||"");if(""==t)continue;const o=r.getTriggerArgs()||{};n.push({tg:r,distance:e,args:o,hotkey:t})}return n}).flat().sort((t,e)=>{var n,o;const i=null===(n=t.args.target)||void 0===n?void 0:n.targetNode,a=null===(o=e.args.target)||void 0===o?void 0:o.targetNode,s=a?.5*a.contains(r.targetNode):0,l=i?.5*i.contains(r.targetNode):0;return+t.distance-e.distance+s-l}),a=new Map;n.revealed=[];for(const r of i){const[o,i]=a.get(r.hotkey)||[1,0];o<e?a.set(r.hotkey,[o+1,r.distance]):o>e||(Object.is(r.tg.targetNode,t)||r.distance>i)&&(r.tg.targetNode.disabled||r.tg.targetNode.setAttribute("data-hotkey",r.hotkey),n.revealed.push(r.tg),a.set(r.hotkey,[o+1,r.distance]))}}}}function F(t){var e;const n=(null===(e=t.parent)||void 0===e?void 0:e.children)||[],r=Object.keys(n).findIndex(e=>e===t.name),o=Object.values(n),i=o.slice(0,r).reverse();return[...o.slice(r+1),...i]}const R=["action","context","target"],M=function(t,e){let{kind:n,name:r,addInitializer:o}=e;"method"==n&&o(function(){const e=this;this.actions[r]=async function(n){let o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};Object.hasOwnProperty(o,"focus")||(o.focus=!0);let i=!1;if(o.data=n,o.silent||(i=!await e.emit("BeforeAction_".concat(r),o),n=o.data),!i)return n=await t.call(e,n,o),o.data=n,o.silent||e.emit("AfterAction_".concat(r),o),n}})};class V extends j{constructor(t,e){delete e.name;for(var n=arguments.length,r=new Array(n>2?n-2:0),o=2;o<n;o++)r[o-2]=arguments[o];return super(t,e,...r)}render(){const t=this;t.parent.onRendered(()=>{var e;const n=t.getTriggerArgs();"function"==typeof(null===(e=n.context)||void 0===e?void 0:e.onTriggerRender)&&n.context.onTriggerRender(n)})}disable(){this.targetNode.disabled=!0}enable(){this.targetNode.disabled=!1}getTriggerArgs(){const t=this,e=[t,...t.parents],n=t.options,{action:r,context:o,target:s}=n,l=a(n,R);if(!r)return;const c=o?t.parent.find(o):e.find(t=>"function"==typeof t.actions[r]),d=s?null==c?void 0:c.find(s):o?null:e.slice(1).find(t=>{var e;return null===(e=t.parent)||void 0===e?void 0:e.targetNode.isSameNode(null==c?void 0:c.targetNode)})||null;return i({action:r,origin:t,context:c,target:d},l)}}async function U(t){const e=this.getComponent(t.target).getTriggerArgs();if(!e)return;const{context:n,action:r,data:o}=e,i=null==n?void 0:n.actions[r];if("function"!=typeof i)throw this.renderError("UNKNOWN_ACTION","Unknown action ".concat(r)+(n?" for ".concat(n.options.type):""));return await i(o,e)}const H=["allow_select"],B=["context","target"];class q extends j{constructor(t,e){let{allow_select:n=!1}=e,r=a(e,H);delete r.name;for(var o=arguments.length,s=new Array(o>2?o-2:0),l=2;l<o;l++)s[l-2]=arguments[l];super(t,i({allow_select:n},r),...s);const c=this;c.eventHooks.click.push(function(t){if(t.defaultPrevented)return;const{target:e}=c.getLabelArgs();null!=e&&e.targetFieldNode&&"legend"!==c.nodeType||e.focus()})}async render(){const t=this;let e=null;for(const n of d(t.targetNode,t.selector)){const r=await t.enhance(n);if(null!=r&&r._isField){if(null!==e)throw t.renderError("EXTRA_FIELD_IN_LABEL","Labels can wrap only one target field, but multiple fields found in form ".concat(t.getPath(),"."));if(void 0!==t.options.target)throw t.renderError("LABEL_EXPLICIT_TARGET","Labels wrapping their target field cannot define explicit target option in form ".concat(t.getPath(),"."));e=r,e.parent=t.parent,t.parent.mountField(e)}}t.parent.onRendered(async()=>{const t=this;t.nodeType=String(t.targetNode.tagName).toLowerCase();const e=t.getLabelArgs().target||{};if(await e.rendered,e.targetFieldNode&&(e.targetFieldNode.id||(e.targetFieldNode.id=p()),t.targetNode.setAttribute("for",e.targetFieldNode.id)),"label"!=t.nodeType){t.targetNode.id||(t.targetNode.id=p());const n=(e.targetNode.getAttribute("aria-labelledby")||"").split(" ").filter(t=>t);0>n.indexOf(t.targetNode.id)&&n.push(t.targetNode.id),e.targetNode.setAttribute("aria-labelledby",n.join(" "))}else if(!e.targetFieldNode)throw t.renderError("LABEL_FOR_NONFIELD","Native <label> tags targetting non native field are not allowed in HTML, you should use different tag.");t.options.allow_select||(t.targetNode.style["user-select"]="none")})}getLabelArgs(){const t=this;let e,n;const r=t.options,{context:o,target:s}=r,l=a(r,B);if(o||s)e=o?t.parent.find(o):t.parent,n=s?e.find(s):e;else if(e=t.parent,"legend"===t.nodeType&&"fieldset"===e.targetNode.tagName.toLowerCase())n=Object.values(e.children)[0];else{const r=e.targetNode.querySelectorAll(t.selector);let o=!1;for(const e in r)if(o){let o=t.getComponent(r[e]);if(null!=o&&o._isField){n=o;break}}else Object.is(r[e],t.targetNode)&&(o=!0)}return i({origin:t,context:e,target:n},l)}}var J;let G;class W extends j{constructor(){G(super(...arguments)),this._isField=!0,this.defaultValue=void 0,this.emptyValue=void 0,Object.is(this,this.root)||(this.name=this.validName(this.options.name,this.targetNode.getAttribute("name")));const t=null!==this.targetNode.getAttribute("value"),e=this.options.hasOwnProperty("value");if(t&&e)throw this.renderError("VALUE_CONFLICT",'Initial value specied both as "value" option and HTML "value" attribute.');this.onRendered(()=>{this.defaultValue=e?this.options.value:t?this.targetNode.getAttribute("value"):this.emptyValue,this.targetFieldNode&&this.targetNode.setAttribute("value",this.defaultValue),this.reset()})}async clear(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};await this.import(this.emptyValue,i({silent:!0},e))}async reset(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};await this.import(void 0,i({silent:!0},e))}}J=W,[G]=c(J,[[M,2,"clear"],[M,2,"reset"]],[]).e;const z=function(t,e){let{kind:n}=e;if("class"==n){var r;let e;return r=class extends t{constructor(){super(...arguments),e(this)}render(){const t=super.render(...arguments),e=this;return e.root.onRendered(()=>{e.fold(null,{operation:e.options.folded?"fold":"unfold",autofocus:!1})}),t}fold(t){var e;let{operation:n="toggle",origin:r,autofocus:o=!0}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const i=this,a="none"==i.targetNode.style.display,s="fold"==n||"unfold"!=n&&!a;i.targetNode.style.display=s?"none":i.originalDisplayProp,i.getTriggers("fold").forEach(t=>{const{foldedClass:e,unfoldedClass:n}=t.options;e&&t.targetNode.classList[s?"add":"remove"](e),n&&t.targetNode.classList[s?"remove":"add"](n)}),i.getTriggers(["addItem","removeItem"]).map(s?t=>t.disable():t=>t.enable()),o&&(null===(e=s?r:i)||void 0===e||e.focus())}},[e]=c(r,[[M,2,"fold"]],[]).e,r}},K=["target"],X=function(t,e){let{kind:n}=e;if("method"==n)return async function(e){let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},{target:r}=n,o=a(n,K);const i=await t.call(this,e,o);try{await r.import(i)}catch(t){}return i}},Y=["target"],$=function(t,e){let{kind:n}=e;if("method"==n)return async function(e){let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},{target:r}=n,o=a(n,Y);try{e=await r.export()}catch(t){}return await t.call(this,e,o)}};var Z;let Q,tt,et;async function nt(t){await t.rendered;for(const e of t.getTriggers(["removeItem","addItem"]))e.targetNode.disabled="removeItem"==e.options.action?t.children.length<=t.min_items&&"clear"!=e.options.failback:t.children.length>=t.max_items}Z=class extends W{constructor(){Q(super(...arguments));const t=this;t.defaultValue={},t.emptyValue={},this.eventHooks.click.push(e=>{!e.defaultPrevented&&t.inheritedOption("focus_on_click",!0)&&this.focus()})}mountField(t){const e=this;if(null!=t&&t._isField){if(void 0!==e.children[t.name])throw e.renderError("REPEATED_FIELD_NAME","Field name '".concat(t.name,"' used more than once in this form level."));e.children[t.name]=t,t.updateId()}}async render(){const t=this;t.originalDisplayProp=t.targetNode.style.display;for(const e of d(t.targetNode,t.selector)){const n=await t.enhance(e);t.mountField(n)}}async export(){return Object.fromEntries(await Promise.all(Object.entries(this.children).map(async t=>{let[e,n]=t;return[e,await n.export(null,{silent:!0})]})))}async import(t){let{focus:e=!1}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const n=this;void 0===t?t=n.defaultValue:""===t&&(t={}),"/demo/periods/0"===n.getPath()&&(console.log("Importing to form",n.getPath(),"with data",t),console.log({data:t,defaultValue:n.defaultValue,emptyValue:n.emptyValue,targetNode:n.targetNode,path:n.getPath(),options:n.options}));const r=Object(t).constructor;if(r!=={}.constructor&&!(t=g(t)))throw new Error("FORM_NOT_PLAIN_OBJECT","Expected plain object or vailid JSON for form import, ".concat(r.name," given."));const o=Object.fromEntries(await Promise.all(Object.entries(n.children).map(async n=>{let[r,o]=n;return[r,await o.import(t[r],{focus:e,silent:!0})]})));return e&&n.focus(),o}async isEmpty(){const t=this;for(const e of Object.values(t.children))if(!await e.isEmpty())return!1;return!0}},({e:[Q],c:[et,tt]}=c(Z,[[[M,X],2,"export"],[[M,$],2,"import"]],[z])),tt();const rt=function(t,e){let{kind:n}=e;return"class"==n?class extends t{async render(){const t=await super.render(...arguments),e=this;return setTimeout(()=>nt(e),1),t}}:"method"==n?async function(){for(var e=arguments.length,n=new Array(e),r=0;r<e;r++)n[r]=arguments[r];const o=await t.call(this,...n);return nt(this),o}:void 0},ot=Symbol("smart_mutex");class it{constructor(){this.mtx=Promise.resolve()}lock(){let t;const e=new Promise(e=>{t=()=>e()}),n=this.mtx;return this.mtx=e,n.then(function(){return t})}}const at=function(t){return function(e,n){let{kind:r}=n;if("method"==r)return async function(){const n=this;n[ot]||(n[ot]={}),n[ot][t]||(n[ot][t]=new it);const r=await n[ot][t].lock();let o,i;try{for(var a=arguments.length,s=new Array(a),l=0;l<a;l++)s[l]=arguments[l];i=await e.call(n,...s)}catch(t){o=t}if(r(),o)throw o;return i}}};var st;let lt,ct,dt,ut,pt,gt,ft;var ht,mt=new WeakSet;dt=[at("list_mutating"),M,X],ut=[M,at("list_mutating"),rt],pt=[M,at("list_mutating"),rt],gt="render";async function yt(t){const e=this;e.templates.header?e.templates.header.after(t):e.targetNode.appendChild(t)}let vt;st=class extends W{constructor(){lt((super(...arguments),n(this,mt),this));this.defaultValue=[],this.emptyValue=[]}async[gt](){const t=this;t.originalDisplayProp=t.targetNode.style.display,t.min_items=Math.max(0,"number"==typeof t.options.min_items?t.options.min_items:1),t.max_items=Math.max(t.min_items,"number"==typeof t.options.max_items?t.options.max_items:1/0),t.children=[],t.templates=function(t){const e={};for(const n of[...t.targetNode.children]){const{role:r="item"}=g(n.getAttribute("data-smark"))||{};switch(r){case"empty_list":case"header":case"separator":case"last_separator":case"footer":case"placeholder":n.setAttribute("data-role",r);case"item":if(void 0!==e[r])throw t.renderError("LIST_DUPLICATE_TEMPLATE","Repated list template role ".concat(r));e[r]=n,e[r].remove()}}if(t.targetNode.children.length){const{role:e="(unspecified)"}=g(t.targetNode.children[0].getAttribute("data-smark"))||{};throw t.renderError("LIST_UNKNOWN_TEMPLATE_ROLE","Unknown list template role ".concat(e))}if(e.last_separator||(e.last_separator=e.separator),null!==e.item.querySelector("[id]"))throw t.renderError("LIST_CONTAINS_ID","List components are not allowed to contain elements with 'id' attribute");return e}(t),t.placeholders=[];const e=t.getNodeOptions(t.templates.item,{type:t.options.of});if(t.options.of&&e.type!=t.options.of)throw t.renderError("LIST_ITEM_TYPE_MISSMATCH","List item type missmatch");for(const e of[t.templates.header,t.templates.footer])if(e){t.targetNode.appendChild(e);for(const n of d(e,t.selector)){const e=await t.enhance(n);if(null!=e&&e._isField)throw t.renderError("FIELD_IN_WRONG_LIST_TEMPLATE","Fields are not allowed in list's template roles other than item.")}}t.root.onRendered(async()=>{for(let e=0;e<t.min_items;e++)await t.addItem({silent:!0});0==t.min_items&&await t.renum(),t.targetNode.setAttribute("aria-live","polite"),t.targetNode.setAttribute("aria-atomic","true")})}onTriggerRender(t){let{action:e,origin:n,context:r}=t;switch(e){case"addItem":case"removeItem":1+[...n.parents].findIndex(t=>Object.is(t,r))&&n.options.hotkey&&function(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"-1";null===t.getAttribute("tabindex")&&t.setAttribute("tabindex",e)}(n.targetNode)}}async export(){const t=this,e=[],n=[],r=!t.inheritedOption("exportEmpties",!1);for(const o of t.children)r&&await o.isEmpty()?e.length<t.min_items&&n.push(o):e.push(await o.export(null,{silent:!0}));for(let r=0;e.length<t.min_items;r++)e.push(await n[r].export(null,{silent:!0}));return e}async import(t){let{focus:e}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const n=this;void 0===t&&(t=n.defaultValue),t instanceof Array||(t=[t]);const r=Math.min(t.length,n.max_items);for(let o=0;o<r;o++)n.children.length<=o&&await n.addItem({silent:!0}),await n.children[o].import(t[o],{focus:e,silent:!0});for(let e=Math.max(t.length,n.min_items);e<n.children.length;)await n.removeItem({silent:!0});t.length>n.max_items&&n.emit("error",{code:"LIST_IMPORT_OVERFLOW",message:"Trying to import array greater than list's max_items. Data beyond max_items ignored.",context:n,data:t,options:n.options});for(let e=t.length;e<n.children.length;e++)n.children[e].reset({silent:!0});e&&n.focus()}async addItem(e){let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const r=this;if(n.action="addItem",n.origin||(n.origin=null),n.context||(n.context=r),n.source||(n.source=null),n.target||(n.target=null),n.position||(n.position="after"),n.autoscroll||(n.autoscroll=null),n.failback||(n.failback="throw"),"after"!=n.position&&"before"!=n.position)throw r.renderError("LIST_WRONG_ADDITEM_POSITION","Invalid value for addItem() position property: ".concat(n.position));if(r.children.length>=r.max_items){if("none"===n.failback);else r.emit("error",{code:"LIST_MAX_ITEMS_REACHED",message:"Cannot add items over max_items boundary",options:n});return}r.children.length&&!n.target&&(n.target="before"==n.position?r.children[0]:r.children[r.children.length-1]);const o=r.templates.item.cloneNode(!0);let i;if(r.children.length?r.children=(await Promise.all(r.children.map(async(t,e)=>{if(t.targetNode.isSameNode(n.target.targetNode)){t.targetNode[n.position](o),i=await r.enhance(o,{type:"form"}),await i.rendered;const e=[t,i];return"before"==n.position&&e.reverse(),e}return t}))).flat():(await t(mt,r,yt).call(r,o),i=await r.enhance(o,{type:"form",name:0}),await i.rendered,r.children.push(i),i.name=0),await r.renum(),n.source){const t=i.find(n.source);if(t){const e=await t.export();await i.import(e,{silent:!0})}}if("elegant"==n.autoscroll&&i)u(i.targetNode,-i.offsetHeight);else{const t=i?"self"==n.autoscroll?i:"parent"==n.autoscroll?i.parent:null:null;t&&t.moveTo()}return r.renderedSync&&i.focus(),i}async removeItem(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const n=this;e.action="removeItem",e.origin||(e.origin=null),e.context||(e.context=n),e.target||(e.target=null),e.autoscroll||(e.autoscroll=null);let r=e.preserve_non_empty||(e.preserve_non_empty=!1);if(e.failback||(e.failback="throw"),!e.target){if(r)for(const t of[...n.children].reverse())if(await t.isEmpty()){e.target=t;break}e.target||(e.target=n.children[n.children.length-1],r=!1)}const o=e.target instanceof Array?e.target:[e.target];for(const t of[...o].reverse()){if(n.children.length<=n.min_items)switch(e.failback){case"none":break;case"clear":return void await t.clear({silent:!0});default:return void n.emit("error",{code:"LIST_MIN_ITEMS_REACHED",message:"Cannot remove items under min_items boundary",options:e})}if(r&&!await t.isEmpty())continue;let o=null,a=null;const s=n.children.filter((n,r,i)=>{if(n.targetNode.isSameNode(t.targetNode)){if("elegant"==e.autoscroll)u(n.targetNode,n.targetNode.offsetHeight);else{const t="self"==e.autoscroll?n:"parent"==e.autoscroll?n.parent:null;t&&t.moveTo()}return o=n,a=i.length-r>1?a=r:0==r?null:r-1,!1}return!0});await n.emit("removeItem_beforeRender",i(i({},e),{},{target:o,targetNode:o.targetNode}),!1),await o.unrender(),n.children=s,await n.renum(),await n.emit("removeItem_afterRender",i(i({},e),{},{target:o,targetNode:o.targetNode}),!1),null!==a&&n.children[a].focus()}}async isEmpty(){const t=this;for(const e of t.children)if(!await e.isEmpty())return!1;return!0}count(t){let{delta:e=0}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return this.children.length+Number(e)}position(t){let{target:e,offset:n=1}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return Number(null==e?void 0:e.name)+Number(n)}async renum(){const e=this;for(const t in e.children)e.children[t].name=t,e.children[t].updateId();if(e.templates.separator||e.templates.last_separator)for(const t in e.children){const n=t>=e.children.length-1,r=t<=0?null:n?"last_separator":"separator",o=e.children[t].targetNode,i=o.previousElementSibling,a=i&&i.getAttribute("data-role");if(a!==r){a&&i.remove();const t=e.templates[r];r&&t&&o.parentElement.insertBefore(t.cloneNode(!0),o)}if(n){const t=o.nextElementSibling;t&&t.remove()}}if(e.templates.empty_list&&(e.children.length?e.templates.empty_list.remove():await t(mt,e,yt).call(e,e.templates.empty_list)),e.templates.placeholder&&e.max_items){let t=(e.max_items||0)-e.children.length;if(t>0&&0===e.children.length&&e.templates.empty_list&&t--,e.placeholders.length<t)for(let n=e.placeholders.length;n<t;n++){const t=e.templates.placeholder.cloneNode(!0);e.templates.footer?e.templates.footer.before(t):e.targetNode.appendChild(t),e.placeholders.push(t)}else for(let n=e.placeholders.length;n>t;n--)e.placeholders.pop().remove()}e.getTriggers("position").forEach(t=>{const e=t.getTriggerArgs();t.targetNode.innerText=this.position(e.data,i(i({},e),{},{silent:!0}))}),e.getTriggers("count").forEach(t=>{const e=t.getTriggerArgs();t.targetNode.innerText=this.count(e.data,i(i({},e),{},{silent:!0}))})}},({e:[lt],c:[ft,ct]}=c(st,[[dt,2,"export"],[[M,$],2,"import"],[ut,2,"addItem"],[pt,2,"removeItem"],[M,2,"count"],[M,2,"position"]],[z,function(t,e){let{kind:n}=e;if("class"==n){var r;let e,n,o;return n=at("list_mutating"),o="render",r=class extends t{constructor(){super(...arguments),e(this)}async[o](){const t=await super.render(...arguments),e=this;if(e.sortable=!!e.options.sortable,e.templates.item.setAttribute("draggable",e.sortable),e.children.forEach(t=>t.targetNode.setAttribute("dragable",e.sortable)),e.sortable){let t=null,n=null;e.targetNode.addEventListener("dragstart",e=>{null===t?(t=e.target,e.stopPropagation()):e.preventDefault()}),e.targetNode.addEventListener("dragover",t=>t.preventDefault()),e.targetNode.addEventListener("drop",e=>{if(!t)return;let r=e.target;for(;r.parentElement&&r.parentElement!=t.parentElement;)r=r.parentElement;n=r}),e.targetNode.addEventListener("dragend",async()=>{n&&await e.move({from:e.getComponent(t),to:e.getComponent(n)}),t=null,n=null})}return t}async move(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};const e=this;let{from:n,to:r}=t;if(null===r||null===n)return;const o=Number(null==n?void 0:n.name),i=Number(null==r?void 0:r.name);if(o==i)return;if(o<i){const t=[...e.children.slice(o+1,i+1),e.children[o]];e.children.splice(o,i-o+1,...t)}else if(o>i){const t=[e.children[o],...e.children.slice(i,o)];e.children.splice(i,o-i+1,...t)}const a=(o<i?1:-1)>0?"after":"before";r.targetNode[a](n.targetNode),e.renum()}},[e]=c(r,[[n,2,"move"]],[]).e,r}},rt])),ct();class Nt extends et{constructor(){vt(super(...arguments));const t=this;t.defaultValue="",t.emptyValue="",t.eventHooks.keydown.push(function(t){if(!t.defaultPrevented&&"Enter"===t.originalEvent.key){const e=t.originalEvent.shiftKey;if("TEXTAREA"===t.context.targetNode.tagName&&!t.originalEvent.ctrlKey&&!e)return;let n=e?t.context.find(".-1")||t.context.find("../.-1"):t.context.find(".+1")||t.context.find("../.+1");n&&(n.focus(),t.originalEvent.preventDefault(),t.originalEvent.stopPropagation())}})}_setTargetFieldValue(t){this.isSingleton||(this.targetFieldNode.value=t)}async render(){const t=this;if(t.isSingleton=!("INPUT"===t.targetNode.tagName||"SELECT"===t.targetNode.tagName||"TEXTAREA"===t.targetNode.tagName),t.isCheckbox=!t.isSingleton&&"checkbox"==String(t.targetNode.type).toLowerCase(),t.isSingleton){await super.render();const e=Object.values(t.children);if(1!=e.length)throw t.renderError("NOT_A_SINGLETON","Singleton forms are only allowed to contain exactly one"+" data field but ".concat(e.length," found."));const n=e[0];if(t.options.type!==n.options.type)throw t.renderError("SINGLETON_TYPE_MISMATCH","Singleton type (".concat(t.options.type,")")+" does not match child field type (".concat(n.options.type,")."));t.targetFieldNode=n.targetNode}else t.targetFieldNode=t.targetNode}async export(t,e){var n;const r=this;if(r.isSingleton)return await r.children[""].export(t,e);const o=r.targetFieldNode;let i;return i=r.isCheckbox?!!o.checked:"json"===r.options.encoding&&"SELECT"===o.tagName.toUpperCase()&&null===(null===(n=o.options[o.selectedIndex])||void 0===n?void 0:n.getAttribute("value"))?JSON.stringify(o.options[o.selectedIndex].text):o.value,"json"===r.options.encoding?g(i)||null:i}async import(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const n=this;if(n.isSingleton)return await n.children[""].import(t,e);void 0===t&&(t=n.defaultValue);let{focus:r=!1}=e;const o=n.targetFieldNode;if("object"==typeof t&&"input"===n.options.type||"json"===n.options.encoding){t||(t=null);t=("TEXTAREA"===o.tagName.toUpperCase()?JSON.stringify(t,null,4):JSON.stringify(t))||""}if(n.isCheckbox)n.targetNode.checked=!!t;else if("json"===n.options.encoding&&"SELECT"===o.tagName.toUpperCase()){if(n._setTargetFieldValue(t||"null"),-1===o.selectedIndex){const e=g(t)||"",n=Array.from(o.options).findIndex(t=>t.text===e);-1!==n&&(o.selectedIndex=n)}}else n._setTargetFieldValue(t);return r&&n.focus(),n.targetNode.value}async isEmpty(){return!(this.isCheckbox?"":await this.export(null,{silent:!0})).trim().length}}var bt;let wt;ht=Nt,[vt]=c(ht,[[[M,X],2,"export"],[[M,$],2,"import"]],[]).e;class Et extends Nt{constructor(){super(...arguments),wt(this)}async render(){await super.render();const t=this;try{m(t.targetFieldNode,"number","NOT_A_NUMBER_FIELD",'Number inputs require an INPUT tag of type "number".')}catch(e){throw t.renderError(e.code,e.message)}}async export(){const t=await super.export(...arguments);return this.isSingleton?t:t.length&&!isNaN(t)?Number(t):null}async import(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(this.isSingleton)return await super.import(t,e);void 0===t&&(t=this.defaultValue);const n=typeof t;return await super.import("number"==n?t:"string"==n&&t.length&&!isNaN(t)?Number(t):null,e)}async isEmpty(){return null===await this.export(null,{silent:!0})}}var _t;let Tt;bt=Et,[wt]=c(bt,[[M,2,"export"],[M,2,"import"]],[]).e;const xt=/T.*/;function At(t){return 8==t.length?new Date([t.substring(0,4),t.substring(4,6),t.substring(6,8)].join("-")):10==t.length&&"-"==t[4]&&"-"==t[7]?new Date(t):NaN}function kt(t){return t.toISOString().replace(xt,"")}class It extends Nt{constructor(){super(...arguments),Tt(this)}async render(){await super.render();const t=this;try{m(t.targetFieldNode,"date","NOT_A_DATE_FIELD",'Date inputs require an INPUT tag of type "date".')}catch(e){throw t.renderError(e.code,e.message)}}async export(){const t=await super.export(...arguments);if(this.isSingleton)return t;if(!t.length)return null;const e=At(t);return isNaN(e)?null:kt(e)}async import(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(this.isSingleton)return await super.import(t,e);const n=t instanceof Date?t:"number"==typeof t?new Date(t):t&&"string"==typeof t?At(t):NaN;return await super.import(isNaN(n)?null:kt(n),e)}async isEmpty(){return null===await this.export(null,{silent:!0})}}var St;let Ot;function Lt(t){const e=String(t.getHours()).padStart(2,"0"),n=String(t.getMinutes()).padStart(2,"0"),r=String(t.getSeconds()).padStart(2,"0");return"".concat(e,":").concat(n,":").concat(r)}_t=It,[Tt]=c(_t,[[M,2,"export"],[M,2,"import"]],[]).e;class Pt extends Nt{constructor(){super(...arguments),Ot(this)}async render(){await super.render();const t=this;try{m(t.targetFieldNode,"time","NOT_A_TIME_FIELD",'Time inputs require an INPUT tag of type "time".')}catch(e){throw t.renderError(e.code,e.message)}}async export(){const t=await super.export(...arguments);if(this.isSingleton)return t;if(!t.length)return null;return f(t)}async import(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(this.isSingleton)return await super.import(t,e);const n=t instanceof Date?Lt(t):"number"==typeof t?Lt(new Date(t)):t&&"string"==typeof t?f(t):null;return await super.import(n,e)}async isEmpty(){return null===await this.export(null,{silent:!0})}}var jt;let Dt;function Ct(t){const e=String(t.getFullYear()).padStart(4,"0"),n=String(t.getMonth()+1).padStart(2,"0"),r=String(t.getDate()).padStart(2,"0"),o=String(t.getHours()).padStart(2,"0"),i=String(t.getMinutes()).padStart(2,"0"),a=String(t.getSeconds()).padStart(2,"0");return"".concat(e,"-").concat(n,"-").concat(r,"T").concat(o,":").concat(i,":").concat(a)}St=Pt,[Ot]=c(St,[[M,2,"export"],[M,2,"import"]],[]).e;class Ft extends Nt{constructor(){super(...arguments),Dt(this)}async render(){await super.render();const t=this;try{m(t.targetFieldNode,"datetime-local","NOT_A_DATETIME_LOCAL_FIELD",'Datetime-local inputs require an INPUT tag of type "datetime-local".')}catch(e){throw t.renderError(e.code,e.message)}}async export(){const t=await super.export(...arguments);if(this.isSingleton)return t;if(!t.length)return null;const e=h(t);return isNaN(e)?null:Ct(e)}async import(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(this.isSingleton)return await super.import(t,e);const n=t instanceof Date?t:"number"==typeof t?new Date(t):t&&"string"==typeof t?h(t):NaN;return await super.import(isNaN(n)?null:Ct(n),e)}async isEmpty(){return null===await this.export(null,{silent:!0})}}var Rt;let Mt;jt=Ft,[Dt]=c(jt,[[M,2,"export"],[M,2,"import"]],[]).e;class Vt extends Nt{constructor(){Mt(super(...arguments));const t=this;let e=t.parent.children[t.name],n=t;e?(t.targetNode.setAttribute("name",e.sharedNodeName),e.radioButtons.push(t.targetNode),n={}):(e=t,e.sharedNodeName=p(),e.targetNode.setAttribute("name",e.sharedNodeName),e.radioButtons=[e.targetNode]);let r=Ut.bind(e);return t.targetNode.addEventListener("click",r),t.targetNode.addEventListener("keydown",r),n}async render(){await super.render();const t=this;try{m(t.targetFieldNode,"radio","NOT_A_RADIO_FIELD",'Radio inputs require an INPUT tag of type "radio".')}catch(e){throw t.renderError(e.code,e.message)}}async export(){var t;return(null===(t=this.radioButtons.find(t=>t.checked))||void 0===t?void 0:t.value)||null}async import(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,{focus:e=!1}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(!this.radioButtons)return;const n=this.radioButtons.find(e=>e.value===t);n?n.checked=!0:this.radioButtons.forEach(t=>t.checked=!1),e&&this.focus()}async isEmpty(){return!(1+this.radioButtons.findIndex(t=>t.checked))}}function Ut(t){if("click"===t.type||"keydown"===t.type&&"Delete"===t.code){var e;const n=this;let r=!0;Object.is(null===(e=n.lastClicked)||void 0===e?void 0:e.target,t.target)&&(r=!n.lastClicked.checked&&"keydown"!==t.type),n.lastClicked={target:t.target,checked:r},t.target.checked=r}}var Ht;let Bt;Rt=Vt,[Mt]=c(Rt,[[[M,X],2,"export"],[[M,$],2,"import"]],[]).e;const qt=/^#([a-f0-9]{3}){1,2}$/i,Jt="\n    opacity: .5;\n    background: repeating-linear-gradient(\n            45deg,\n            black,\n            black 10px,\n            white 10px,\n            white 20px\n        ),\n        black;\n    background-blend-mode: difference;\n";class Gt extends Nt{constructor(){Bt(super(...arguments));this.defaultValue=null,this.emptyValue=null,this.eventHooks.keydown.push(t=>{t.defaultPrevented||"Delete"===t.originalEvent.key&&t.context.clear()})}_setTargetFieldValue(t){var e;if(this.isSingleton)return;let n=qt.test(t);4==(null===(e=t)||void 0===e?void 0:e.length)&&(t="#".concat(t[1]).concat(t[1]).concat(t[2]).concat(t[2]).concat(t[3]).concat(t[3])),this.targetFieldNode.value=n?t.toLowerCase():"#000000"}async render(){await super.render();const t=this;if(t.isSingleton)return;t._setTargetFieldValue(t.targetFieldNode.getAttribute("value"));try{m(t.targetFieldNode,"color","NOT_A_COLOR_FIELD",'Color inputs require an INPUT tag of type "color".')}catch(e){throw t.renderError(e.code,e.message)}const e=t.targetFieldNode.getAttribute("value");t.isDefined=null!==e&&""!==e.trim(),t.defaultStyleAttr=t.targetFieldNode.getAttribute("style")||"",t.defaultStyleAttr&&(t.defaultStyleAttr+="; "),t.isDefined||t.targetFieldNode.setAttribute("style",t.defaultStyleAttr+Jt);const n=e=>{"Enter"!==e.code&&"Space"!==e.Code&&void 0!==e.code||(t.isDefined=!0,t.targetFieldNode.setAttribute("style",t.defaultStyleAttr))};t.targetFieldNode.addEventListener("keydown",n),t.targetFieldNode.addEventListener("click",n),t.targetFieldNode.addEventListener("change",n)}async export(){let t=await super.export(...arguments);return this.isSingleton||(t=this.isDefined&&qt.test(t)?t.toLowerCase():null),t}async import(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const n=this;if(n.isSingleton)return await n.children[""].import(t,e);var r;(void 0===t&&(t=n.defaultValue),null!==t&&qt.test(t))?(n.isDefined=!0,4==(null===(r=t)||void 0===r?void 0:r.length)&&(t="#".concat(t[1]).concat(t[1]).concat(t[2]).concat(t[2]).concat(t[3]).concat(t[3])),n.targetFieldNode.setAttribute("style",n.defaultStyleAttr)):(n.isDefined=!1,n.targetFieldNode.setAttribute("style",n.defaultStyleAttr+Jt));const o=await super.import(t,e);return n.isDefined?o:null}async isEmpty(){return null===await this.export(null,{silent:!0})}}Ht=Gt,[Bt]=c(Ht,[[M,2,"export"],[M,2,"import"]],[]).e;const Wt=["customActions"];for(const[t,e]of Object.entries({trigger:V,label:q,form:et,list:ft,input:Nt,number:Et,date:It,time:Pt,"datetime-local":Ft,radio:Vt,color:Gt}))D(t,e);class zt extends et{constructor(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},{customActions:n={}}=e;const r=i(i({},a(e,Wt)),{},{name:"",type:"form"});super(t,r,null);const o=this;o.setNodeOptions(o.targetNode,r),o.actions=i(i({},o.actions),Object.fromEntries(Object.entries(n).map(t=>{let[e,n]=t;return[e,n.bind(o)]}))),o.targetNode.addEventListener("click",U.bind(o),!0),new C(o)}async render(){this.targetNode.setAttribute("aria-busy","true"),await super.render(),this.targetNode.setAttribute("aria-busy","false")}}return zt.createType=D,zt});//# sourceMappingURL=SmarkForm.umd.js.map
